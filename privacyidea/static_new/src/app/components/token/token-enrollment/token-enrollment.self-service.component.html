<div aria-label="Token Enrollment"
     class="token-enrollment-container">
  <h3 class="margin-left-1">Token Enrollment</h3>
  <mat-form-field class="width-100">
    <mat-select [(ngModel)]="selectedTokenType"
                [panelClass]="'multi-column-panel'">
      @for (type of tokenService.tokenTypeOptions(); track type) {
        <mat-option class="token-type-option type-option"
                    [value]="type">{{ type.info.split(":")[0] }}
        </mat-option>
      }
      <button (click)="versioningService.openDocumentation('tokentypes')"
              class="card-button type-help-button"
              mat-flat-button>
        <mat-icon>info_outline</mat-icon>
        Help About Tokentypes
      </button>
    </mat-select>
    <mat-hint class="token-type-hint">
      @if (selectedTokenType().info) {
        {{ selectedTokenType().info.split(":")[1] }}
      }
    </mat-hint>
  </mat-form-field>
  <div class="enroll-button-container">
    <button (click)="reopenEnrollmentDialog()"
            [disabled]="enrollResponse() === null"
            mat-icon-button>
      <mat-icon>open_in_new</mat-icon>
    </button>
    <button (click)="enrollToken()"
            [disabled]="
        motpPin() !== repeatMotpPin() || setPinValue() !== repeatPinValue()"
            [ngClass]="{
        'disabled-button':
          motpPin() !== repeatMotpPin() || setPinValue() !== repeatPinValue(),
        'card-button': true,
      }"
            mat-flat-button>
      <mat-icon>add</mat-icon>
      Enroll {{ selectedTokenType().key }} Token
    </button>
  </div>
  @switch (selectedTokenType().key) {
    @case ("hotp") {
      <app-enroll-hotp [generateOnServer]="generateOnServer"
                       [otpLength]="otpLength"
                       [otpKey]="otpKey"
                       [hashAlgorithm]="hashAlgorithm"
                       [description]="description" />
    }
    @case ("totp") {
      <app-enroll-totp [generateOnServer]="generateOnServer"
                       [otpLength]="otpLength"
                       [otpKey]="otpKey"
                       [hashAlgorithm]="hashAlgorithm"
                       [description]="description"
                       [timeStep]="timeStep" />
    }
    @case ("spass") {
      <app-enroll-spass [description]="description" />
    }
    @case ("motp") {
      <app-enroll-motp [motpPin]="motpPin"
                       [repeatMotpPin]="repeatMotpPin"
                       [generateOnServer]="generateOnServer"
                       [description]="description" />
    }
    @case ("sshkey") {
      <app-enroll-sshkey [description]="description"
                         [sshPublicKey]="sshPublicKey" />
    }
    @case ("yubikey") {
      <app-enroll-yubikey [otpKey]="otpKey"
                          [otpLength]="otpLength"
                          [description]="description"
                          [testYubiKey]="testYubiKey" />
    }
    @case ("remote") {
      <app-enroll-remote [remoteSerial]="remoteSerial"
                         [remoteServer]="remoteServer"
                         [remoteRealm]="remoteRealm"
                         [remoteUser]="remoteUser"
                         [remoteResolver]="remoteResolver"
                         [checkPinLocally]="checkPinLocally"
                         [description]="description" />
    }
    @case ("yubico") {
      <app-enroll-yubico [yubikeyIdentifier]="yubikeyIdentifier"
                         [description]="description" />
    }
    @case ("radius") {
      <app-enroll-radius [checkPinLocally]="checkPinLocally"
                         [radiusServerConfiguration]="radiusServerConfiguration"
                         [radiusUser]="radiusUser"
                         [description]="description" />
    }
    @case ("sms") {
      <app-enroll-sms [phoneNumber]="phoneNumber"
                      [smsGateway]="smsGateway"
                      [description]="description"
                      [readNumberDynamically]="readNumberDynamically" />
    }
    @case ("4eyes") {
      <app-enroll-foureyes [separator]="separator"
                           [description]="description"
                           [onlyAddToRealm]="onlyAddToRealm"
                           [requiredTokensOfRealms]="requiredTokenOfRealms" />
    }
    @case ("applspec") {
      <app-enroll-applspec [serviceId]="serviceId"
                           [generateOnServer]="generateOnServer"
                           [otpKey]="otpKey"
                           [description]="description" />
    }
    @case ("daypassword") {
      <app-enroll-daypassword [otpKey]="otpKey"
                              [otpLength]="otpLength"
                              [hashAlgorithm]="hashAlgorithm"
                              [description]="description"
                              [timeStep]="timeStep" />
    }
    @case ("certificate") {
      <app-enroll-certificate [caConnector]="caConnector"
                              [certTemplate]="certTemplate"
                              [pem]="pem"
                              [description]="description" />
    }
    @case ("email") {
      <app-enroll-email [emailAddress]="emailAddress"
                        [readEmailDynamically]="readEmailDynamically"
                        [description]="description" />
    }
    @case ("indexedsecret") {
      <app-enroll-indexedsecret [otpKey]="otpKey"
                                [description]="description" />
    }
    @case ("paper") {
      <app-enroll-paper [description]="description" />
    }
    @case ("push") {
      <app-enroll-push [description]="description" />
    }
    @case ("question") {
      <app-enroll-question [answers]="answers"
                           [description]="description" />
    }
    @case ("registration") {
      <app-enroll-registration [description]="description" />
    }
    @case ("tan") {
      <app-enroll-tan [description]="description" />
    }
    @case ("tiqr") {
      <app-enroll-tiqr [description]="description" />
    }
    @case ("u2f") {
      <app-enroll-u2f [description]="description" />
    }
    @case ("vasco") {
      <app-enroll-vasco [vascoSerial]="vascoSerial"
                        [useVascoSerial]="useVascoSerial"
                        [otpKey]="otpKey"
                        [description]="description" />
    }
    @case ("webauthn") {
      <app-enroll-webauthn [firstDialog]="firstDialog"
                           [enrollResponse]="enrollResponse"
                           [description]="description" />
    }
    @case ("passkey") {
      <app-enroll-passkey [firstDialog]="firstDialog"
                          [enrollResponse]="enrollResponse"
                          [description]="description" />
    }
  }
  <div class="flex-row gap-1">
    <div class="flex-column width-100">
      <input style="display: none"
             type="text" />

      <input style="display: none"
             type="password" />

      <h4 class="enroll-h4">Assign Token to a Container</h4>
      <mat-form-field class="width-50 input-height">
        <mat-label>Enter Container</mat-label>
        <input [(ngModel)]="containerService.selectedContainer"
               [matAutocomplete]="containerAuto"
               matInput />
        <mat-autocomplete #containerAuto="matAutocomplete">
          @for (option of containerService.filteredContainerOptions(); track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
    </div>

    <div class="flex-column user-pin-container">
      <h4 class="enroll-h4">Set Pin</h4>
      <div class="user-pin-input">
        <input [(ngModel)]="setPinValue"
               [type]="'password'"
               class="input"
               placeholder="Pin" />

        <input [(ngModel)]="repeatPinValue"
               [type]="'password'"
               class="input"
               placeholder="Repeat Pin" />
      </div>
    </div>
  </div>
</div>
