<div aria-label="Token Get Serial" class="token-get-serial">
  <div class="token-get-serial-container">
    <div class="token-get-serial-header">
      <h2>Get Serial Number</h2>
    </div>
    <p class="help-block" translate>
      By entering an OTP value you can get the serial number of the token. You
      can also enter additional optional parameters, to narrow down the search
      for the token. So you can only search within certain token types or in
      assigned or unassigned tokens.
    </p>
    <div class="token-get-serial-content"></div>
    <h3 translate>OTP Value (required)</h3>
    <mat-form-field>
      <input
        matInput
        [(ngModel)]="otpValue"
        id="otpValue"
        name="otpValue"
        type="number"
        (keyup.enter)="onPressEnter()"
        placeholder="enter some OTP value"
        required
      />
    </mat-form-field>
    <h3 translate>Token Type</h3>
    <mat-form-field>
      <mat-select
        [(ngModel)]="tokenType"
        (keyup.enter)="onPressEnter()"
        appearance="outline"
        matInput
      >
        @for (type of tokenTypes; track type[0]) {
        <mat-option [value]="type[0]">{{ type[1] }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <h3 translate>Assignment State</h3>
    <mat-form-field>
      <mat-select
        [(ngModel)]="assignmentState"
        (keyup.enter)="onPressEnter()"
        appearance="outline"
        matInput
      >
        @for (assi of assignmentStates; track assi[0]) {
        <mat-option [value]="assi[0]" translate>{{ assi[1] }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <h3 translate>Serial Substring</h3>
    <mat-form-field>
      <input
        matInput
        [(ngModel)]="serialSubstring"
        (keyup.enter)="onPressEnter()"
        id="serialSubstring"
        name="serialSubstring"
        placeholder="an optional serial substring"
      />
    </mat-form-field>
    <h3 translate>Count Window</h3>
    <mat-form-field>
      <input
        matInput
        [(ngModel)]="countWindow"
        id="countWindow"
        name="countWindow"
        type="number"
        (keyup.enter)="onPressEnter()"
        placeholder="The number of lookahead OTP values. Default = 10"
      />
    </mat-form-field>
  </div>
  @switch (currentStep) { @case ('counting') {
  <div class="token-get-serial-footer">
    @if (countIsLarge()) {
    <span translate>
      Your search would include {{ count }} tokens. This can take a lot of time
      and could even timeout. Do you want to run the search? You might also
      cancel this and narrow down the search!</span
    >
    <br />
    <confirm-button (onClick)="onPressEnter()" [text]="'Run Search'" />
    <abort-button (onClick)="reset()" />
    } @else {
    <mat-progress-bar mode="indeterminate" translate>
      Counting tokens...
    </mat-progress-bar>
    }
  </div>
  } @case ('searching') {
  <div class="token-get-serial-footer">
    <mat-progress-bar mode="indeterminate" translate>
      Searching token...
    </mat-progress-bar>
  </div>
  } @case ('found') {
  <div class="token-get-serial-footer">
    @if (foundSerial) {
    <div class="alert alert-success">
      <span translate>
        The Serial number for the OTP value {{ otpValue() }} is
        <a ui-sref="token.details({tokenSerial:serial})">{{ foundSerial }}</a
        >.
      </span>
    </div>
    } @else {
    <div class="alert alert-warning">
      <span translate>
        No Serial number could be found for OTP value {{ otpValue() }}.
      </span>
    </div>
    }
    <br />
    <confirm-button (onClick)="reset()" [text]="' OK '" />
  </div>

  } @default {
  <div class="token-get-serial-footer">
    <confirm-button
      [isEnabled]="otpValue() !== ''"
      (onClick)="onPressEnter()"
      [text]="'Run Search'"
    />
  </div>
  }}
</div>
