<ng-template #tokenCard let-hasMargin="hasMargin">
  <app-token-card [active]="tokenIsActive"
                  [ngClass]="hasMargin ? 'margin-right-1' : ''"
                  [containerSelection]="containerSelection"
                  [containerSerial]="containerSerial"
                  [isProgrammaticChange]="isProgrammaticChange"
                  [refreshContainerDetails]="refreshContainerDetails"
                  [refreshContainerOverview]="refreshContainerOverview"
                  [refreshTokenDetails]="refreshTokenDetails"
                  [refreshTokenOverview]="refreshTokenOverview"
                  [revoked]="revoked"
                  [selectedContent]="selectedContent"
                  [states]="states"
                  [tokenSelection]="tokenSelection"
                  [tokenSerial]="tokenSerial"/>
</ng-template>

<div aria-label="Token Layout"
     class="token-layout">
  @if (!overflowService.isWidthOverflowing(".token-layout",
    overflowService.getOverflowThreshold(selectedContent()))) {
    <ng-container [ngTemplateOutlet]="tokenCard" [ngTemplateOutletContext]="{ hasMargin: true }"/>
  }
  <mat-drawer-container>
    @if (overflowService.isWidthOverflowing(
      ".token-layout",
      overflowService.getOverflowThreshold(selectedContent())
    )) {
      <mat-drawer #drawer
                  [mode]="'over'"
                  [ngClass]="[ this.overflowService.isHeightOverflowing('.token-layout',
                  675) ? 'token-drawer-overflow' : 'token-drawer' ]">
        <ng-container [ngTemplateOutlet]="tokenCard"/>
      </mat-drawer>
    }
    <mat-drawer-content>
      <div class="drawer-content-div">
        @if (overflowService.isWidthOverflowing(
          ".token-layout",
          overflowService.getOverflowThreshold(selectedContent())
        )) {
          <div class="drawer-button-div">
            <button mat-fab
                    (click)="drawer.toggle()"
                    class="drawer-button">
              <mat-icon>keyboard_arrow_right</mat-icon>
            </button>
          </div>
        }
        <main>
          <div [ngClass]="[
              overflowService.isWidthOverflowing(
                '.token-layout',
                overflowService.getOverflowThreshold(selectedContent()))
                ? 'main-margin'
                : 'main-margin-overflow']">
            @switch (selectedContent()) {
              @case ("token_overview") {
                <app-token-table #tokenTableComponent
                                 [isProgrammaticChange]="isProgrammaticChange"
                                 [tokenSerial]="tokenSerial"
                                 [containerSerial]="containerSerial"
                                 [selectedContent]="selectedContent"
                                 [tokenSelection]="tokenSelection"></app-token-table>
              }
              @case ("token_enrollment") {
                <app-token-enrollment [tokenSerial]="tokenSerial"
                                      [containerSerial]="containerSerial"
                                      [selectedContent]="selectedContent"
                                      [isProgrammaticChange]="isProgrammaticChange" />
              }
              @case ("token_details") {
                <app-token-details #tokenDetailsComponent
                                   [tokenSerial]="tokenSerial"
                                   [active]="tokenIsActive"
                                   [revoked]="revoked"
                                   [refreshTokenDetails]="refreshTokenDetails"
                                   [containerSerial]="containerSerial"
                                   [selectedContent]="selectedContent"
                                   [isProgrammaticChange]="
                    isProgrammaticChange
                  "></app-token-details>
              }
              @case ("token_challenges") {
                <app-challenges-table [selectedContent]="selectedContent"
                                      [tokenSerial]="tokenSerial" />
              }
              @case ("token_applications") {
                <app-token-applications [tokenSerial]="tokenSerial"
                                        [selectedContent]="selectedContent" />
              }
              @case ("token_get_serial") {
                <app-token-get-serial [tokenSerial]="tokenSerial"
                                      [selectedContent]="selectedContent" />
              }
              @case ("container_overview") {
                <app-container-table #containerTableComponent
                                     [containerSerial]="containerSerial"
                                     [selectedContent]="selectedContent"
                                     [containerSelection]="containerSelection" />
              }
              @case ("container_details") {
                <app-container-details #containerDetailsComponent
                                       [containerSerial]="containerSerial"
                                       [tokenSerial]="tokenSerial"
                                       [states]="states"
                                       [refreshContainerDetails]="refreshContainerDetails"
                                       [selectedContent]="selectedContent"
                                       [isProgrammaticChange]="isProgrammaticChange" />
              }
              @case ("container_create") {
                <app-container-create [containerSerial]="containerSerial"
                                      [selectedContent]="selectedContent" />
              }
            }
          </div>
        </main>
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
