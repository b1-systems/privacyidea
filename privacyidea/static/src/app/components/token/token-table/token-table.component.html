<div aria-label="Token Table" class="item-table">
  <div class="filter-paginator-container">
    <mat-form-field class="table-filter" subscriptSizing="dynamic">
      <mat-label>Filter</mat-label>
      <input #input (keyup)="handleFilterInput($event)" aria-label="Filter Input"
             class="filter-input" matInput
             placeholder="Example query: 'type: hotp userid: 1000'">
    </mat-form-field>
    <mat-paginator (page)="handlePageEvent($event)" [length]="length"
                   [pageIndex]="pageIndex" [pageSizeOptions]="pageSizeOptions"
                   [pageSize]="pageSize" aria-label="Select page of tokens" showFirstLastButtons>
    </mat-paginator>
  </div>
  <span class="filter-text"><mat-icon class="filter-icon">filter_alt</mat-icon>Filter by:&nbsp;
    @for (filterKeyword of apiFilter; track filterKeyword) {
      @if (filterKeyword === 'container_serial') {
        <br/>
        <button style="margin-left: 94px" mat-fab extended
                (click)="toggleKeywordInFilter(filterKeyword , input)"
                class="keyword-button">
          <mat-icon class="filter-button-icon"
                    [ngClass]="this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove-icon' : 'add-icon'">
              {{ this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove_circle' : 'add_circle' }}
          </mat-icon>
          {{ filterKeyword }}
        </button>
      } @else {
        <button mat-fab extended (click)="toggleKeywordInFilter(filterKeyword , input)"
                class="keyword-button">
          <mat-icon class="filter-button-icon"
                    [ngClass]="this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove-icon' : 'add-icon'">
              {{ this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove_circle' : 'add_circle' }}
          </mat-icon>
          {{ filterKeyword }}
        </button>
      }
    }
    <button (click)="showAdvancedFilter.set(!showAdvancedFilter())" class="advanced-filter-button"
            extended
            mat-fab>
          <mat-icon class="filter-button-icon">
               {{ showAdvancedFilter() ? 'remove' : 'add' }}
          </mat-icon>
    </button>
    @if (showAdvancedFilter()) {
      @for (filterKeyword of advancedApiFilter; track filterKeyword) {
        <button mat-fab extended (click)="toggleKeywordInFilter(filterKeyword , input)"
                class="keyword-button">
          <mat-icon class="filter-button-icon"
                    [ngClass]="this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove-icon' : 'add-icon'">
            {{ this.tableUtilsService.isFilterSelected(filterKeyword, input.value) ? 'remove_circle' : 'add_circle' }}
          </mat-icon>
          {{ filterKeyword }}
        </button>
      }
    }
    </span>
  <table (matSortChange)="handleSortEvent()" [dataSource]="dataSource()"
         aria-label="Token Data Table"
         class="token-table" mat-table matSort>
    @for (column of columnDefinitions; track column) {
      <ng-container [matColumnDef]="column.key">
        <th *matHeaderCellDef attr.aria-label="{{ column.label }} Header" mat-header-cell
            mat-sort-header>
          {{ column.label }}
        </th>
        <td *matCellDef="let element" attr.aria-label="{{ column.label }} Cell" mat-cell>
          <ng-container>
            @if (column.key === 'username' || column.key === 'container_serial'
            || column.key === 'user_realm') {
              <a attr.aria-label="{{ column.label }} Link" href="#">
                {{ element[column.key] }}
              </a>
            } @else if (column.key === 'realms') {
              <div class="scrollable-container realm-list">
                @for (realm of element[column.key]; track realm; let idx = $index) {
                  <a attr.aria-label="{{ column.label }} Link" href="#">
                    {{ realm }}
                  </a><br style="margin-top: 3px"/>
                }
              </div>
            } @else if (column.key === 'serial') {
              <a attr.aria-label="{{ column.label }} Link"
                 (click)="tokenSelected(element.serial)">
                {{ element[column.key] }}
              </a>
            } @else {
              <span
                [ngClass]="tableUtilsService.getClassForColumn(column.key, element)"
                (click)="handleColumnClick(column.key, element)">
                {{ tableUtilsService.getDisplayText(column.key, element) }}
              </span>
            }
          </ng-container>
        </td>
      </ng-container>
    }
    <tr *matHeaderRowDef="displayedColumns" aria-label="Header Row" mat-header-row></tr>
    <tr *matRowDef="let row; columns: displayedColumns;" aria-label="Data Row" mat-row></tr>
    <tr *matNoDataRow aria-label="No Data Row" class="mat-row">
      <td [attr.colspan]="displayedColumns.length" aria-label="No Data Cell" class="mat-cell">
        No data matching the filter.
      </td>
    </tr>
  </table>
</div>
